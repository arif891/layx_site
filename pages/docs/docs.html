<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Demo Document</title>

        <link rel="stylesheet" href="/layx/layx.css">

        <link rel="stylesheet" href="/assets/css/base.css">
        <link rel="stylesheet" href="/assets/css/pages/docs.css">

    </head>

    <body>
        <header>
            <navbar class="fixed update-scroll-state layx__navbar">
                <div class="wrapper">
                    <div class="main modern center move">
                        <div class="brand">
                            <a href="/">
                                <h5 class="logo-text">Layx</h5>
                            </a>
                            <button class="toggler"></button>
                        </div>
                        <div class="warp-able left">
                            <div>
                                <nav class="link-wrapper">
                                    <a href="/pages/docs/docs.html" class="link">Docs</a>
                                    <a href="/pages/components.html" class="link">Components</a>
                                    <a href="/pages/download.html" class="link">Download</a>
                                    <a href="/pages/about.html" class="link">About</a>
                                    <a href="/pages/blog.html" class="link">Blog</a>
                                </nav>
                            </div>
                            <div class="nav__end">
                                <div class="theme-update nav__theme_wrapper">
                                    <div class="nav__theme">
                                        <button data-theme-value="light"></button>
                                        <button data-theme-value="dark"></button>
                                        <button data-theme-value="auto"></button>
                                    </div>
                                </div>
                                <a class="btn dark wide" href="#">Download</a>
                            </div>
                        </div>
                    </div>
                </div>
            </navbar>
        </header>

        <main>
            <section class="doc__section">
                <container class="doc__container">
                    <layout class="doc__layout gap">
                        <div class="x-3 side__nav" id="side-nav">
                            <div class="links__wrapper">
                                <h6>Getting started</h6>
                                <div class="links">
                                    <a href="/pages/docs/getting_started/introduction.html" class="link"
                                        id="int-link">Introduction</a>
                                    <a href="/pages/docs/getting_started/installation.html"
                                        class="link">Installation</a>
                                    <a href="/pages/docs/getting_started/quick_start.html" class="link">Quick Start</a>
                                    <a href="/pages/docs/getting_started/cli.html" class="link">CLI</a>
                                </div>
                            </div>
                            <div class="links__wrapper">
                                <h6>Core Concepts</h6>
                                <div class="links">
                                    <a href="/pages/docs/core_concepts/overview.html" class="link">Overview</a>
                                </div>
                            </div>
                            <div class="links__wrapper">
                                <h6>Customize</h6>
                                <div class="links">
                                    <a href="/pages/docs/customize/customize.html" class="link">Customize</a>
                                </div>
                            </div>
                            <div class="links__wrapper">
                                <h6>Layout System</h6>
                                <div class="links">
                                    <a href="/pages/docs/layout_system/breakpoints.html" class="link">Breakpoints</a>
                                    <a href="/pages/docs/layout_system/container_component.html" class="link">Container
                                        Component</a>
                                    <a href="/pages/docs/layout_system/layout_component.html" class="link">Layout
                                        Component</a>
                                </div>
                            </div>
                            <div class="links__wrapper">
                                <h6>Main</h6>
                                <div class="links">
                                    <a href="/pages/docs/main/base.html" class="link">Base</a>
                                    <a href="/pages/docs/main/typography.html" class="link">Typography</a>
                                </div>
                            </div>
                            <div class="links__wrapper">
                                <h6>Components</h6>
                                <div class="links">
                                    <a href="/pages/docs/components/accordion.html" class="link">Accordion</a>
                                    <a href="/pages/docs/components/alert.html" class="link">Alert</a>
                                    <a href="/pages/docs/components/breadcrumb.html" class="link">Breadcrumb</a>
                                    <a href="/pages/docs/components/button.html" class="link">Button</a>
                                    <a href="/pages/docs/components/card.html" class="link">Card</a>
                                    <a href="/pages/docs/components/carousel.html" class="link">Carousel</a>
                                    <a href="/pages/docs/components/chart.html" class="link">Chart</a>
                                    <a href="/pages/docs/components/dialog.html" class="link">Dialog</a>
                                    <a href="/pages/docs/components/draggable.html" class="link">Draggable</a>
                                    <a href="/pages/docs/components/form.html" class="link">Form</a>
                                    <a href="/pages/docs/components/footer.html" class="link">Footer</a>
                                    <a href="/pages/docs/components/navbar.html" class="link">Navbar</a>
                                    <a href="/pages/docs/components/pagination.html" class="link">Pagination</a>
                                    <a href="/pages/docs/components/popover.html" class="link">Popover</a>
                                    <a href="/pages/docs/components/sheet.html" class="link">Sheet</a>
                                    <a href="/pages/docs/components/section.html" class="link">Section</a>
                                    <a href="/pages/docs/components/tab.html" class="link">Tab</a>
                                    <a href="/pages/docs/components/tooltip.html" class="link">Tooltip</a>
                                    <a href="/pages/docs/components/window.html" class="link">Window</a>
                                </div>
                            </div>
                            <div class="links__wrapper">
                                <h6>Helpers</h6>
                                <div class="links">
                                    <a href="/pages/docs/helpers/flex_and_grid.html" class="link">Flex and Grid</a>
                                    <a href="/pages/docs/helpers/layout.html" class="link">Layout</a>
                                </div>
                            </div>
                            <div class="links__wrapper">
                                <h6>Utilities</h6>
                                <div class="links">
                                    <a href="/pages/docs/utilities/border.html" class="link">Border</a>
                                    <a href="/pages/docs/utilities/color.html" class="link">Color</a>
                                    <a href="/pages/docs/utilities/display.html" class="link">Display</a>
                                    <a href="/pages/docs/utilities/flex.html" class="link">Flex</a>
                                    <a href="/pages/docs/utilities/grid.html" class="link">Grid</a>
                                    <a href="/pages/docs/utilities/height.html" class="link">Height</a>
                                    <a href="/pages/docs/utilities/margin.html" class="link">Margin</a>
                                    <a href="/pages/docs/utilities/opacity.html" class="link">Opacity</a>
                                    <a href="/pages/docs/utilities/padding.html" class="link">Padding</a>
                                    <a href="/pages/docs/utilities/position.html" class="link">Position</a>
                                    <a href="/pages/docs/utilities/shadow.html" class="link">Shadow</a>
                                    <a href="/pages/docs/utilities/width.html" class="link">Width</a>
                                    <a href="/pages/docs/utilities/z_index.html" class="link">Z-index</a>
                                </div>
                            </div>
                            <div class="links__wrapper">
                                <h6>Other</h6>
                                <div class="links">
                                    <a href="/pages/docs/other/background.html" class="link">Background</a>
                                    <a href="/pages/docs/other/dynamic.html" class="link">Dynamic</a>
                                    <a href="/pages/docs/other/icon.html" class="link">Icon</a>
                                    <a href="/pages/docs/other/pwa.html" class="link">PWA</a>
                                    <a href="/pages/docs/other/scroll_driven_animation.html" class="link">Scroll Driven
                                        Animation</a>
                                    <a href="/pages/docs/other/smooth_scroll.html" class="link">Smooth Scroll</a>
                                    <a href="/pages/docs/other/syntax_highlighter.html" class="link">Syntax
                                        Highlighter</a>
                                    <a href="/pages/docs/other/theme.html" class="link">Theme</a>
                                    <a href="/pages/docs/other/view_transition.html" class="link">View Transition</a>
                                </div>
                            </div>
                            <div class="links__wrapper">
                                <h6>About</h6>
                                <div class="links">
                                    <a href="/pages/docs/about/contributing.html" class="link">Contributing</a>
                                    <a href="/pages/docs/about/license.html" class="link">License</a>
                                </div>
                            </div>
                        </div>
                        <div class="x-6 main" id="main">

                        </div>
                        <div class="x-3 side__progress" id="side-progress">

                        </div>
                    </layout>
                </container>
            </section>
        </main>

        <footer class="footer__secton">
            <container class="footer__container">
                <layout class="footer__layout gap">
                    <div class="x-12 sub-x footer__middle">
                        <div class="x-12 x-lg-4 brand">
                            <div class="brand__text_wrapper">
                                <h2 class="brand__text">LayX</h2>
                            </div>
                            <p>A modern layout framework that makes building websites faster, easier, and more flexible.
                            </p>
                        </div>
                        <div class="link__block x-12 x-lg-6 xs-lg-7">
                            <div class="link-wrapper">
                                <h5>Main</h5>
                                <a href="/pages/docs/docs.html">Docs</a>
                                <a href="/pages/components.html">Components</a>
                                <a href="/pages/examples.html">Examples</a>
                                <a href="/pages/download.html">Download</a>
                            </div>
                            <div class="link-wrapper">
                                <h5>About</h5>
                                <a href="/pages/approach.html">Approach</a>
                                <a href="/pages/features.html">Features</a>
                                <a href="/pages/about.html">About</a>
                                <a href="/pages/blog.html">Blog</a>
                            </div>
                            <div class="link-wrapper">
                                <h5>Other</h5>
                                <a href="/pages/sponsor.html">Sponsor</a>
                                <a href="/pages/contributing.html">Contributing</a>
                                <a href="/pages/issues.html">Issues</a>
                                <a href="/pages/license.html">License</a>
                            </div>
                        </div>
                    </div>
                    <div class="x-12 footer__end">
                        <p>© 2024 LayX</p>
                        <a class="footer__github" href="https://github.com/arif891/Layx">
                            <svg class="icon">
                                <use href="/assets/image/svg/icons.svg#github" />
                            </svg>
                        </a>
                        <p>MIT License</p>
                    </div>
                </layout>
            </container>
        </footer>

        <script>
            const sideNav = document.getElementById('side-nav');
            const main = document.getElementById('main');
            const sideProgress = document.getElementById('side-progress');

            const navLinks = sideNav.querySelectorAll('a');

            navLinks.forEach((link) => {
                link.setAttribute('data-main-url', `${getPathFromUrl(link.href)}parital/main/${getFileNameFromUrl(link.href)}`);
                link.setAttribute('data-side-url', `${getPathFromUrl(link.href)}parital/side/${getFileNameFromUrl(link.href)}`);
                handleLink(link);
            });

            function handleLink(link) {
                const href = link.href;
                const mainUrl = link.dataset.mainUrl;
                const sideUrl = link.dataset.sideUrl;

                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    handleClick(e, mainUrl, sideUrl, href, link);
                });
            }

            function handleClick(e, mainUrl, sideUrl, href, link) {
                e.preventDefault();
                fetchContent(mainUrl, sideUrl, href, link, true); // 'true' to indicate manual navigation
            }

            async function fetchContent(mainUrl, sideUrl, href, link, pushState = false) {
                try {
                    const [mainResponse, sideResponse] = await Promise.all([
                        fetch(mainUrl),
                        fetch(sideUrl)
                    ]);

                    if (mainResponse.ok && sideResponse.ok) {
                        const mainContent = await mainResponse.text();
                        const sideContent = await sideResponse.text();

                        document.getElementById('main').innerHTML = mainContent;
                        document.getElementById('side-progress').innerHTML = sideContent;

                        // Update the browser URL if it's a manual navigation
                        if (pushState) {
                            history.pushState({ mainUrl, sideUrl }, '', href);
                        }

                        // Update the active link
                        updateActiveLink(href);

                    } else {
                        // If the partial content fetch fails, check if the original link works
                        checkOriginalLink(href);
                    }

                } catch (error) {
                    // On error, check if the original link works
                    console.error('Error fetching content:', error);
                    checkOriginalLink(href);
                }
            }

            // Function to check if the original link works, and if so, redirect the user to that URL
            async function checkOriginalLink(href) {
                try {
                    const response = await fetch(href);

                    if (response.ok) {
                        // If the original link works, redirect to the original document
                        window.location.href = href;
                    } else {
                        console.error('Original document is also unavailable:', response.status);
                    }
                } catch (error) {
                    console.error('Error checking original document:', error);
                }
            }

            // Handle browser back/forward navigation
            window.addEventListener('popstate', (e) => {
                e.preventDefault(); // Prevent default behavior

                if (e.state && e.state.mainUrl && e.state.sideUrl) {
                    // Fetch the content based on the stored state in the history
                    fetchContent(e.state.mainUrl, e.state.sideUrl, document.location.href, null, false);
                } else {
                    // If there's no state (e.g., initial page load), load the current URL
                    const link = findLinkByHref(document.location.href);
                    if (link) {
                        handleClick(e, link.dataset.mainUrl, link.dataset.sideUrl, document.location.href, link);
                    } else {
                        // If no matching link is found, you might want to handle this case (e.g., show a 404 page)
                        console.error('No matching link found for:', document.location.href);
                    }
                }
            });

            // New function to update the active link
            function updateActiveLink(href) {
                navLinks.forEach((link) => {
                    if (link.href === href) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }

            // New function to find a link by its href
            function findLinkByHref(href) {
                return Array.from(navLinks).find(link => link.href === href);
            }

            function getPathFromUrl(url) {
                const urlObj = new URL(url);
                const path = urlObj.pathname;

                return path.substring(0, path.lastIndexOf('/')) + '/';
            }

            function getFileNameFromUrl(url) {
                return url.substring(url.lastIndexOf('/') + 1);
            }

            // Initial content load from the first link
            document.addEventListener('DOMContentLoaded', () => {
                if (navLinks.length > 0) {
                    const firstLink = navLinks[0];
                    const mainUrl = firstLink.dataset.mainUrl;
                    const sideUrl = firstLink.dataset.sideUrl;
                    const href = firstLink.href;

                    fetchContent(mainUrl, sideUrl, href, firstLink, true);
                } else {
                    console.error('No navigation links found');
                }
            });
        </script>

        <script src="/layx/layx.js" type="module"></script>

        <script src="/assets/js/base.js"></script>
        <script src="/assets/js/pages/docs.js"></script>
    </body>

</html>